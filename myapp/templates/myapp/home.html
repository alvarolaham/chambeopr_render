<!DOCTYPE html>
{% comment %} home.html {% endcomment %}
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChambeoPR</title>
    {% load static %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    {% include "myapp/navbar.html" %}
    <div class="container mt-4">
        {% block content %}
        <div class="hero text-center">
            <h1>Book services fast</h1>
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="I am looking for...">
                    <button id="search-button"><i class="fas fa-search"></i></button>
                </div>
                <div id="search-results" class="search-filter-results-column"></div>
            </div>
        </div>
        <div class="service-grid mt-1">
            <a href="{% url 'home_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-home"></i>
                </div>
                <h3 class="services-text">Home Services</h3>
            </a>
            <a href="{% url 'car_and_vehicle_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-car"></i>
                </div>
                <h3 class="services-text">Car & Vehicle</h3>
            </a>
            <a href="{% url 'pet_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-paw"></i>
                </div>
                <h3 class="services-text">Pets</h3>
            </a>
            <a href="{% url 'moving_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <h3 class="services-text">Moving</h3>
            </a>
            <a href="{% url 'professional_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <h3 class="services-text">Professional</h3>
            </a>
            <a href="{% url 'events_services' %}" class="service-item no-underline">
                <div class="service-icon">
                    <i class="fas fa-birthday-cake"></i>
                </div>
                <h3 class="services-text">Events</h3>
            </a>
        </div>
        {% endblock %}
        {% if messages %}
            <div class="container mt-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    {% include "myapp/footer.html" %}
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            let typingTimer;
            const doneTypingInterval = 0; // milliseconds
            
            $('#search-input').on('click', function() {
                performSearch();
            });

            $('#search-input').on('input', function() {
                clearTimeout(typingTimer);
                if ($('#search-input').val()) {
                    typingTimer = setTimeout(performSearch, doneTypingInterval);
                } else {
                    $('#search-results').hide();
                }
            });
        
            function performSearch() {
                const query = $('#search-input').val().toLowerCase();
                const regex = new RegExp('^' + query, 'i'); // Match from the start
                $.ajax({
                    url: '{% url "search_services" %}',
                    data: {'q': query},
                    dataType: 'json',
                    success: function(data) {
                        displayResults(data, regex);
                    }
                });
            }
        
            function displayResults(data, regex) {
                let resultsHtml = '';
                let hasResults = false;
                for (const [category, services] of Object.entries(data.filtered_services)) {
                    const filteredServices = services.filter(service => regex.test(service) || !$('#search-input').val()); // Show all if no input
                    if (filteredServices.length > 0) {
                        hasResults = true;
                        const categoryUrl = getCategoryUrl(category); // Get the URL for the category
                        resultsHtml += `<div class="search-filter-result category" onclick="window.location.href='${categoryUrl}'">`;
                        resultsHtml += `<span>${category.replace(/_/g, ' ').toUpperCase()}</span>`;
                        resultsHtml += '</div>';
                        filteredServices.forEach(service => {
                            resultsHtml += `<div class="search-filter-result">`;
                            resultsHtml += `<span>${service}</span>`;
                            resultsHtml += '</div>';
                        });
                    }
                }
                if (!hasResults) {
                    resultsHtml = '<div class="search-filter-result no-results">No matches found</div>';
                }
                $('#search-results').html(resultsHtml).show();
            }
        
            // Close search results when clicking outside
            $(document).on('click', function(event) {
                if (!$(event.target).closest('.search-container').length) {
                    $('#search-results').hide();
                }
            });
        });

        // Function to get the URL for a given category
        function getCategoryUrl(category) {
            const categoryUrls = {
                'home_services': '{% url "home_services" %}',
                'car_and_vehicle_services': '{% url "car_and_vehicle_services" %}',
                'pet_services': '{% url "pet_services" %}',
                'moving_services': '{% url "moving_services" %}',
                'professional_services': '{% url "professional_services" %}',
                'events_services': '{% url "events_services" %}'
            };
            return categoryUrls[category] || '#';
        }
    </script>
</body>
</html>
